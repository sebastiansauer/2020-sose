---
title: "Kapitel 4, ARM"
author: "ses"
date: "6/15/2021"
output: 
  html_document:
    toc: TRUE
    number_sections: TRUE
editor_options: 
  chunk_output_type: console
---

# Quelle

<https://sebastiansauer.github.io/2021-sose/QuantMeth1/Syntax/2021-06-15.html>



# Pakete laden

```{r message = FALSE}
library(tidyverse)
library(arm)  # nicht wirklich wichtig, nur für Funktion "display"
```


# Lineare Transformationen 1: Linearen Einfluss auf Regressionsgewichte



## Daten laden: `earn`

Vgl. S. 53 in ARm:

```{r}
earn <- read_csv("https://raw.githubusercontent.com/sebastiansauer/2021-sose/master/data/ARM/heights.csv")
```


```{r}
glimpse(earn)
```


## lm0

```{r}
lm0 <- lm(earn ~ height, 
          data = earn)
display(lm0)
```


```{r}
earn <-
  earn %>% 
  mutate(height_cm = height / 2.54,
         height_mm = height_cm / 10,
         height_m = height_cm * 100)
```

```{r}
lm0a <- lm(earn ~ height_cm, 
          data = earn)
display(lm0a)
```


```{r}
lm0b <- lm(earn ~ height_mm, 
          data = earn)
display(lm0b)
```


```{r}
lm0c <- lm(earn ~ height_m, 
          data = earn)
display(lm0c)
```


# Lineare Transformationen 2: z-Transformationen


## Daten laden: `kidsiq`

S. 55., 4.2 ARM:

```{r}
kidsiq <- read_csv("https://raw.githubusercontent.com/sebastiansauer/2021-sose/master/data/ARM/kidsiq.csv")
```

## lm1: Interaktionseffekt

```{r}
lm1 <- lm(kid_score ~ mom_hs + mom_iq + mom_hs:mom_iq,
          data = kidsiq)
display(lm1)
```

Interpretation!



## lm2: Zentrieren 

```{r}
kidsiq <-
  kidsiq %>% 
  mutate(mom_hs_c = mom_hs - mean(mom_hs),
         mom_iq_c = mom_iq - mean(mom_iq))  # centered
```


Effekte des Zentrierens:

```{r}
kidsiq %>% 
  summarise(mom_iq_avg = mean(mom_iq),
            mom_iq_c_avg = mean(mom_iq_c),
            mom_iq_sd = sd(mom_iq),
            mom_iq_c_sd = sd(mom_iq_c))
```



```{r}
kidsiq %>% 
  summarise(mom_hs_avg = mean(mom_hs),
            mom_hs_c_avg = mean(mom_hs_c),
            mom_hs_sd = sd(mom_hs),
            mom_hs_c_sd = sd(mom_hs_c))
```


```{r}
kidsiq %>% 
  count(mom_hs_c)
```




```{r}
lm2 <- lm(kid_score ~ mom_hs_c + mom_iq_c + mom_hs_c:mom_iq_c,
          data = kidsiq)
display(lm2)
```


```{r}
lm2a <- lm(kid_score ~ mom_hs + mom_iq_c + mom_hs:mom_iq_c,
          data = kidsiq)
display(lm2a)
```



## Interaktionseffekt visualisieren

```{r}
kidsiq %>% 
  ggplot(aes(x = mom_iq, y = kid_score, color = as.factor(mom_hs))) +
  geom_smooth(method = "lm") +
  geom_point()
```


```{r}
kidsiq %>% 
  ggplot(aes(x = mom_iq, y = kid_score, color = as.factor(mom_hs))) +
  facet_wrap(~ mom_hs) +
  geom_smooth(method = "lm") +
  geom_point()
```


## lm3: z-Transformation


```{r}
kidsiq <-
  kidsiq %>% 
  mutate(mom_iq_z = (mom_iq - mean(mom_iq)) / sd(mom_iq),
         mom_hs_z = (mom_hs - mean(mom_hs)) / sd(mom_hs))
```


```{r}
kidsiq %>% 
  count(mom_hs_z)
```


```{r}
lm3 <- lm(kid_score ~ mom_hs + mom_iq_z + mom_hs:mom_iq_c, 
          data = kidsiq)

display(lm3)
```




```{r}
lm3a <- lm(kid_score ~ mom_hs_z + mom_iq_z + mom_hs_z:mom_iq_z, 
          data = kidsiq)

display(lm3a)
```




# Modelle mit `log(y)`

4.4 in ARM

$y=ab$, $y ~ x*y$ --> log(Y)


*Multiplikative Zusammenhänge!*

S. 59

log(y) = b0 + b1*x1 + ...  | eponenziere

y = e^(b0 + b1*x1 + ... )

y = e^b0 * e^b1x1 * ...


## lm4: earn_log


```{r}
earn <-
  earn %>% 
  mutate(earn_log = log(earn))
```

Zur Basis e.

*Achtung: log nur für x > 0!*


```{r}
lm4 <- lm(earn_log ~ height, 
          data = earn %>% filter(earn > 0))
display(lm4)
```

Was bedeutet der Wert 0.06?

--> Steigt X (height) um 1, so steigt im Modell Y um 0.06 log-Punkte: `earn` steigt um *6%*!



Zum Vergleich: additives Modell:

```{r}
lm4a <- lm(earn ~ height, 
          data = earn %>% filter(earn > 0))
display(lm4a)
```

Hier leider R^2 beim multiplikativen Modell (log-Modell) nicht besser, entgegen der Erwartung.


## lm5: earn_log mit zwei Prädiktoren

```{r}
earn %>% 
  count(sex)
```

Leider wissen wir nicht, ob Frauen mit 1 oder mit 2 codiert sind. Gehen wir davon aus, dass Männer mit 1 kodiert sind (vgl. Buch ARM, S. 61).

```{r}
earn <-
  earn %>% 
  mutate(male = case_when(
    sex == 2 ~ 0,  # Frau
    sex == 1 ~ 1))  # Mann
```



```{r}
lm5 <- lm(earn_log ~ height + male,
          data = earn %>% filter(earn > 0))
display(lm5)
```


## lm6: Mit z-Transformation und Interaktion

```{r}
earn <-
  earn %>% 
  mutate(height_z = scale(height))
```


```{r}
lm6 <- lm(earn_log ~ height_z + male + height_z:male,
          data = earn %>% filter(earn > 0))
display(lm6)
```


Delogarithimieren zur Interpretation der Koeffizienten

```{r}
exp(9.52)
```


```{r}
exp(0.06)
```

```{r}
exp(0.42)
```



Die Reihenfolge der Prädiktoren spielt *keine* Rolle:

```{r}
lm6a <- lm(earn_log ~ height_z:male + male + height_z ,
          data = earn %>% filter(earn > 0))
display(lm6)
```


# LogY-LogX-Modelle

```{r}
earn <-
  earn %>% 
  mutate(height_log = log(height))
```


```{r}
lm7 <- lm(earn_log ~ height_log + male,
          data = earn %>% filter(earn > 0))
display(lm7)
```



# Weitere Transformationen

## Diskretisierung metrischer Prädiktoren

```{r}
lm7 <- lm(kid_score ~ as.factor(mom_work),
          data = kidsiq)
display(lm7)
```


# "Buschbeispiel" - `mesquite`

## Daten laden: `mesquite`

```{r}
mesquite <- read_csv("https://raw.githubusercontent.com/sebastiansauer/2021-sose/master/data/ARM/mesquite.csv")
```

```{r}
glimpse(mesquite)
```

## Lineares Modell mit allen Prädiktoren

Vgl. S. 70 in ARM; die Daten passen nicht ganz zum Buch. Die Werte weichen etwas zum Buch ab.

```{r}
lm7 <- lm(LeafWt ~ ., data = mesquite)
display(lm7)
```


## Multiplikatives Modell

```{r}
lm8 <- lm(log(LeafWt) ~ log(Diam1) + log(Diam2) + log(TotHt) + log (CanHt) + log(Dens) + Group,
          data = mesquite)

display(lm8)
```


